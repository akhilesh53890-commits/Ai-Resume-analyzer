<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI Resume Analyzer — Single File (Fixed)</title>
  <style>
  :root{--bg:#f5f7fb;--card:#fff;--accent:#2563eb;--muted:#6b7280;--gap:16px}
  *{box-sizing:border-box}
  body{font-family:Segoe UI, Roboto, Arial, sans-serif;background:var(--bg);color:#111;margin:0;padding:24px}
  .site-header{max-width:1100px;margin:0 auto 18px}
  .container{max-width:1100px;margin:12px auto;display:grid;grid-template-columns:1fr 420px;gap:var(--gap)}
  .panel{background:var(--card);padding:16px;border-radius:8px}
  textarea{width:100%;padding:10px;border:1px solid #e5e7eb;border-radius:6px}
  .controls-row{display:flex;gap:8px;margin-top:10px}
  .controls-row button{padding:8px 10px;border-radius:6px;border:1px solid #d1d5db;background:#fff;cursor:pointer}
  .primary{background:var(--accent);color:#fff;border-color:transparent}
  .muted{color:var(--muted)}
  .company-row{padding:10px;border-radius:6px;border:1px solid #eef2ff;margin-bottom:8px}
  .bar{height:10px;background:#eef2ff;border-radius:6px;overflow:hidden;margin-top:6px}
  .bar > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#7c3aed)}
  @media (max-width:980px){.container{grid-template-columns:1fr}}
  </style>
  <!-- CDN libs (need internet). If offline is required, tell me and I'll vendor them into the file. -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</head>
<body>
  <header class="site-header"><h1>AI Resume Analyzer</h1><p class="muted">Upload a resume (PDF/DOCX/TXT) or paste text, then analyze.</p></header>

  <main class="container">
	<section class="panel input-panel">
	  <h2>Resume</h2>
	  <textarea id="resumeInput" placeholder="Paste your resume text here..." rows="12"></textarea>
	  <div class="controls-row">
		<button id="loadSampleResume">Load Sample Resume</button>
		<button id="clearResume">Clear</button>
	  </div>

	  <div style="margin-top:10px;">
		<label for="resumeFile">Upload Resume (PDF, DOCX, TXT): </label>
		<input id="resumeFile" type="file" accept=".pdf,.docx,.doc,.txt" />
		<button id="analyzeFileBtn">Analyze Uploaded</button>
		<div id="status" style="margin-top:8px;color:var(--muted)"></div>
	  </div>

	  <h3 style="margin-top:12px">Companies (one per line: Name | keyword1, keyword2)</h3>
	  <textarea id="companiesInput" rows="6" placeholder="Google | Python, Machine Learning"></textarea>
	  <div class="controls-row">
		<button id="loadSampleCompanies">Load Sample Companies</button>
		<button id="clearCompanies">Clear</button>
	  </div>

	  <div class="analyze-row" style="margin-top:12px;display:flex;align-items:center;gap:10px">
		<label for="minMatch">Minimum Match %: <span id="minMatchVal">30</span></label>
		<input id="minMatch" type="range" min="0" max="100" value="30" />
		<button id="analyzeBtn" class="primary">Analyze</button>
	  </div>

	  <details style="margin-top:10px"><summary>Help / Tips</summary>
		<ul><li>Use <code>Name | keyword1, keyword2</code> per line for companies.</li>
		<li>.doc (old Word) is not supported — save as .docx or PDF.</li></ul>
	  </details>
	</section>

	<section class="panel results-panel">
	  <h2>Results</h2>
	  <div id="summary"></div>
	  <div id="results"></div>
	  <div class="controls-row" style="margin-top:8px"><button id="exportCsv">Export CSV</button><button id="resetAll">Reset All</button></div>
	</section>
  </main>

  <footer style="max-width:1100px;margin:12px auto;color:var(--muted)"><small>Client-side keyword matcher. Improve skill lists for better results.</small></footer>

  <script>
  // Robust single-file analyzer with clearer status and error handling.
  (function(){
	// --- Configurable skill list ---
	const skillKeywords = [
	  'machine learning','deep learning','python','tensorflow','pytorch','nlp','natural language processing',
	  'data science','data analysis','pandas','numpy','scikit-learn','sql','postgresql','mongodb','nosql',
	  'javascript','typescript','react','angular','vue','node','express','rest','graphql','html','css',
	  'docker','kubernetes','aws','azure','gcp','devops','ci/cd','git','linux','bash','powershell',
	  'java','spring','kotlin','android','swift','ios','c#','dotnet','c++','opencv','selenium'
	];
	const skillList = [...new Set(skillKeywords.map(s=>s.toLowerCase()))].sort((a,b)=>b.length-a.length);

	// --- Elements ---
	const resumeInput = document.getElementById('resumeInput');
	const companiesInput = document.getElementById('companiesInput');
	const analyzeBtn = document.getElementById('analyzeBtn');
	const resultsEl = document.getElementById('results');
	const summaryEl = document.getElementById('summary');
	const minMatch = document.getElementById('minMatch');
	const minMatchVal = document.getElementById('minMatchVal');
	const loadSampleCompanies = document.getElementById('loadSampleCompanies');
	const loadSampleResume = document.getElementById('loadSampleResume');
	const exportCsv = document.getElementById('exportCsv');
	const clearResume = document.getElementById('clearResume');
	const clearCompanies = document.getElementById('clearCompanies');
	const resetAll = document.getElementById('resetAll');
	const resumeFileInput = document.getElementById('resumeFile');
	const analyzeFileBtn = document.getElementById('analyzeFileBtn');
	const statusEl = document.getElementById('status');

	function logStatus(msg, isError){ if(statusEl){ statusEl.textContent = msg || ''; statusEl.style.color = isError ? '#b91c1c' : 'var(--muted)'; } console.debug('Status:', msg); }

	minMatch.addEventListener('input', ()=>{ minMatchVal.textContent = minMatch.value });

	const sampleResume = 'Experienced software engineer with 6 years building web applications using JavaScript, React, Node.js and Typescript. Worked on backend services in Python and Flask, performed data analysis with Pandas and SQL. Familiar with Docker, Kubernetes and AWS. Experience with machine learning prototypes using TensorFlow and PyTorch.';
	const sampleCompaniesText = 'Google | Python, Machine Learning, TensorFlow, Kubernetes, GCP\nAmazon | Java, AWS, Distributed Systems, SQL\nFacebook | JavaScript, React, GraphQL, PHP\nMicrosoft | C#, .NET, Azure, SQL\nStripe | Ruby, API, Payments, JavaScript\nSmallML Startup | Python, Machine Learning, PyTorch, NLP';

	loadSampleResume.addEventListener('click', ()=>{ resumeInput.value = sampleResume; logStatus('Sample resume loaded'); });
	loadSampleCompanies.addEventListener('click', ()=>{ companiesInput.value = sampleCompaniesText; logStatus('Sample companies loaded'); });
	clearResume.addEventListener('click', ()=>{ resumeInput.value=''; logStatus('Resume cleared'); });
	clearCompanies.addEventListener('click', ()=>{ companiesInput.value=''; logStatus('Companies cleared'); });
	resetAll.addEventListener('click', ()=>{ resumeInput.value=''; companiesInput.value=''; resultsEl.innerHTML=''; summaryEl.innerHTML=''; logStatus('Reset all'); });

	// --- File readers ---
	function readTxt(file){ return new Promise((res,rej)=>{ const fr=new FileReader(); fr.onload=()=>res(String(fr.result)); fr.onerror=rej; fr.readAsText(file); }); }

	async function readPdf(file){
	  try{
		if(typeof window['pdfjsLib']==='undefined') throw new Error('PDF.js not available');
		const arrayBuffer = await file.arrayBuffer();
		pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';
		const pdf = await pdfjsLib.getDocument({data:arrayBuffer}).promise;
		let text = '';
		for(let i=1;i<=pdf.numPages;i++){ const page = await pdf.getPage(i); const content = await page.getTextContent(); const strs = content.items.map(it=>it.str||''); text += strs.join(' ') + '\n\n'; }
		return text;
	  }catch(err){ console.error('PDF read error', err); throw err; }
	}

	async function readDocx(file){
	  try{
		if(typeof window['JSZip']==='undefined') throw new Error('JSZip not available');
		const arrayBuffer = await file.arrayBuffer();
		const zip = await JSZip.loadAsync(arrayBuffer);
		const doc = zip.file('word/document.xml');
		if(!doc) return '';
		const xml = await doc.async('string');
		const parser = new DOMParser(); const xmlDoc = parser.parseFromString(xml,'application/xml');
		const texts = xmlDoc.getElementsByTagName('w:t'); let out=''; for(let i=0;i<texts.length;i++) out += (texts[i].textContent||'') + ' '; return out;
	  }catch(err){ console.error('DOCX read error', err); throw err; }
	}

	async function handleFile(file){
	  const name = (file.name||'').toLowerCase();
	  if(name.endsWith('.txt')) return await readTxt(file);
	  if(name.endsWith('.pdf')) return await readPdf(file);
	  if(name.endsWith('.docx')) return await readDocx(file);
	  if(name.endsWith('.doc')) throw new Error('.doc (binary) not supported; convert to .docx or .pdf');
	  // fallback
	  return await readTxt(file);
	}

	resumeFileInput.addEventListener('change', async (e)=>{
	  const f = e.target.files && e.target.files[0]; if(!f) return; logStatus('Reading file...');
	  try{ const txt = await handleFile(f); resumeInput.value = txt || ''; logStatus(txt ? 'File loaded — analysis started' : 'File loaded but no text extracted'); analyze(); }
	  catch(err){ logStatus('File error: '+(err.message||err), true); }
	});

	analyzeFileBtn.addEventListener('click', ()=>{ analyze(); });

	// --- Analyzer functions ---
	function escapeRegex(s){ return s.replace(/[.*+?^${}()|[\\]\\]/g, '\\$&'); }
	function extractSkills(text){ if(!text) return []; const s=text.toLowerCase(); const found=new Set(); skillList.forEach(skill=>{ const re=new RegExp('\\b'+escapeRegex(skill)+'\\b','i'); if(re.test(s)) found.add(skill); }); return Array.from(found); }

	function parseCompanies(text){ const lines = String(text||'').split(/\r?\n/).map(l=>l.trim()).filter(Boolean); return lines.map(line=>{ const parts=line.split('|'); return {name: parts[0].trim(), keywords: (parts[1]||'').split(',').map(k=>k.trim()).filter(Boolean)} }); }

	function scoreCompany(company, resumeText, resumeSkills){ const kws = (company.keywords && company.keywords.length) ? company.keywords : company.name.split(/\s+/); const total=kws.length||1; let matched=0; const matchedList=[]; const missingList=[]; const rt=String(resumeText||'').toLowerCase(); kws.forEach(k=>{ const clean=k.toLowerCase(); if(resumeSkills.includes(clean) || new RegExp('\\b'+escapeRegex(clean)+'\\b','i').test(rt)){ matched++; matchedList.push(k); } else missingList.push(k); }); const pct=Math.round((matched/total)*100); return {company:company.name, matched, total, pct, matchedList, missingList}; }

	function renderResults(results){ resultsEl.innerHTML=''; if(!results || !results.length){ resultsEl.innerHTML = '<p class="muted">No companies matched the minimum threshold.</p>'; return; } results.forEach(r=>{ const row=document.createElement('div'); row.className='company-row'; row.innerHTML = `<strong>${escapeHtml(r.company)}</strong> <span class="muted">(${r.pct}% match)</span><div class="bar"><i style="width:${r.pct}%"></i></div><div class="muted">Matched: ${escapeHtml(r.matchedList.join(', ')||'None')} &nbsp; Missing: ${escapeHtml(r.missingList.join(', ')||'None')}</div>`; resultsEl.appendChild(row); }); }

	function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

	function analyze(){ try{ logStatus('Analyzing...'); const resumeText = resumeInput.value || ''; const companiesText = companiesInput.value || ''; const companies = parseCompanies(companiesText); if(!companies.length){ logStatus('No companies specified. Load sample companies or enter companies to analyze.', true); return; } const skillsFound = extractSkills(resumeText); summaryEl.innerHTML = `<p class="muted">Detected <strong>${skillsFound.length}</strong> skills: ${escapeHtml(skillsFound.join(', '))}</p>`; const allScores = companies.map(c=>scoreCompany(c, resumeText, skillsFound)); const threshold = Number(minMatch.value||0); const filtered = allScores.filter(r=>r.pct>=threshold).sort((a,b)=>b.pct-a.pct); renderResults(filtered); logStatus('Analysis complete'); } catch(err){ console.error(err); logStatus('Analysis error: '+(err.message||err), true); } }

	analyzeBtn.addEventListener('click', ()=>{ analyze(); });

	exportCsv.addEventListener('click', ()=>{
	  try{
		const companies = parseCompanies(companiesInput.value||''); const skillsFound = extractSkills(resumeInput.value||''); const allScores = companies.map(c=>scoreCompany(c, resumeInput.value||'', skillsFound)); const rows=[['Company','Match%','Matched','Missing']]; allScores.forEach(r=>rows.push([r.company,String(r.pct),r.matchedList.join('; '),r.missingList.join('; ')])); const csv = rows.map(r=>r.map(cell=>`"${String(cell).replace(/"/g,'""')}"`).join(',')).join('\n'); const blob=new Blob([csv],{type:'text/csv'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='resume-analysis.csv'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); logStatus('CSV exported');
	  }catch(err){ console.error(err); logStatus('CSV export error: '+(err.message||err), true); }
	});

	// auto-load samples so UI isn't empty
	companiesInput.value = sampleCompaniesText; resumeInput.value = sampleResume;
	logStatus('Ready — load a resume or paste text then click Analyze');
  })();
  </script>
</body>
</html>

